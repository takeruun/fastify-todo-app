name: Donwload sql data

inputs:
  TOKEN:
    description: github accout token

runs:
  using: 'composite'
  steps:
    - name: download
      continue-on-error: true
      run: |
        REPONSE=$(curl -H 'Authorization: token ${{ inputs.TOKEN }}' -H 'Accept: application/vnd.github.v3+json' https://api.github.com/repos/takeruun/fastify-todo-app/actions/artifacts | jq '.artifacts[0]')
        EXPIRED=echo $REPONSE | jq '.expired'
        if [ $EXPIRED = false ]; then
          exit 1
        else
          DOWNLOAD_URL=echo $REPONSE | jq '.archive_download_url'
        fi

        curl -L -H 'Authorization: token ${{ inputs.TOKEN }}' $DOWNLOAD_URL -o init.sql
